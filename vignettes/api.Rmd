---
title: "Complete Guide for Seven Bridges API R Client"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 4
    number_sections: true
    theme: "flatly"
    highlight: "textmate"
    css: "sevenbridges.css"
vignette: >
  %\VignetteIndexEntry{Complete Guide for Seven Bridges API R Client}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<a name="top"></a>

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```


`Important note:` This is a work-in-progress project to update the `sevenbridges` package. Accordingly, this vignette will also change as new features are implemented.

# Introduction

`sevenbridges2` is an R package that provides an interface for Seven Bridges public API. The supported platforms includes the [Seven Bridges Platform](https://igor.sbgenomics.com/), [Cancer Genomics Cloud (CGC)](https://www.cancergenomicscloud.org), and [Cavatica](https://cavatica.sbgenomics.com).

Learn more from our documentation on the [Seven Bridges Platform](https://docs.sevenbridges.com/page/api) and the [Cancer Genomics Cloud (CGC)](http://docs.cancergenomicscloud.org/v1.0/page/the-cgc-api).

Unlike the current `sevenbridges` package that is built on top of reference classes, the `sevenbridges2` package is based on more modern and lightweight R6 classes. However, the basic idea and way of constructing API requests is largely preserved.

## R Client for Seven Bridges API

The `sevenbridges2` package only supports v2+ versions of the API, since versions prior to V2 are not compatible with the Common Workflow Language (CWL). This package provides a simple interface for accessing and trying out various methods.

There are two ways of constructing API calls. For instance, you can use low-level API calls which use arguments like `path`, `query`, and `body`. These are documented in the API reference libraries for the [Seven Bridges Platform](https://docs.sevenbridges.com/reference#list-all-api-paths) and the [CGC](http://docs.cancergenomicscloud.org/docs/new-1). An example of a low-level request to "list all projects" is shown below. In this request, you can also pass `query` and `body` as a list.

```{r}
library("sevenbridges2")
a <- Auth$new(token = "<your_token>", platform = "aws-us")
a$api(path = "user", method = "GET")
```

***(Advanced user option)*** The second way of constructing an API request is to directly use the `httr` package to make your API calls, as shown below.

```{r}
a$user()
```

## API General Information

Before we start, keep in mind the following:

__`offset` and `limit`__

Every API call accepts two arguments named `offset` and `limit`.

- Offset defines where the retrieved items started.
- Limit defines the number of items you want to get.

By default, `offset` is set to `0` and `limit` is set to `100`. As such, your API request returns the __first 100 items__ when you list items or search for items by name. To search and list all items, use `complete = TRUE` in your API request.


__Search by ID__

When searching by ID, your request will return your exact resource as it is unique. As such, you do not have to set `offset` and `limit` manually. It is a good practice to find your resources by their ID and pass this ID as an input to your task. You can find a resource's ID in the final part of the URL on the visual interface or via the API requests to list resources or get a resource's details.

__Search by name__

Search by name returns all partial matches unless you specify `exact = TRUE`.

## Installation

The `sevenbridges2` package is currently only available on Seven Bridges internal GitLab repository.

To install it from `develop` branch, use:

```{r}
remotes::install_gitlab("r-stack/sevenbridges2@develop",
  auth_token = "${GIT_ACCESS_TOKEN}",
  host = "gitlab.sbgenomics.com",
  force = TRUE, upgrade = "never"
)
```

Where `GIT_ACCESS_TOKEN` is your personal access token for GitLab.


# Quickstart


## Create `Auth` Object

Before you can access your account via the API, you have to provide your credentials. You can obtain your credentials in the form of an ["authentication token"](https://docs.sevenbridges.com/v1.0/docs/get-your-authentication-token) from the **Developer Tab** under **Account Settings** on the visual interface. Once you've obtained this, create an `Auth` object, so it remembers your authentication token and the path for the API. All subsequent requests will draw upon these two pieces of information.

Let's load the package first:

```{r, eval = TRUE, message = FALSE}
library("sevenbridges2")
```

You have three different ways to provide your token. Choose from one method below:

1. [Direct authentication.](#method1) Here you should provide your developer token and a base URL for the platform of interest (alternatively, you can provide the name of the platform - these are the available options `cgc`, `aws-us`, `aws-eu`, `ali-cn`, `cavatica`, `f4c` - the default platform is `aws-us`) as a function call arguments to `Auth()`. This will create the platform authentication object and temporarily set up your token and platform base URL as environment variables `SB_AUTH_TOKEN` and `SB_API_ENDPOINT`. This way, your token will not be directly stored in the Auth object, but you will still be able to access it by calling the `get_token()` method. Keep in mind that these environment variables are session-specific and are deleted when the session ends.

2. [Authentication via system environment variables.](#method2) By default this will read the credential information from two existing system environment variables: `SB_API_ENDPOINT` and `SB_AUTH_TOKEN`. Of course, assuming that you have previously set these environment variables. Alternatively, you can specify the names of the system environment variables you want to be loaded using the `sysenv_token` and `sysenv_url` arguments.
3. [Authentication via the user configuration file.](#method3) This file, by default `$HOME/.sevenbridges/credentials`, provides an organized way to collect and manage all your API authentication information for Seven Bridges platforms.


If you need to be logged into multiple accounts at the same time (which can also be for different platforms), please use either the second or third method.

<div style="margin-left:3em"><a name="method1"/>**Method 1: Direct authentication**

This is the most common method to construct the `Auth` object. For example:

```{r}
(a <- Auth$new(platform = "aws-us", token = "<your-token>"))
```

<a name="method2"/>**Method 2: Environment variables**

To set the two environment variables in your system, you could use
the function `sbg_set_env()`. For example:

```{r}
sbg_set_env(url = "https://api.sbgenomics.com/v2/", token = "<your_token>")
```

Note that these environment variables are session-specific.

Create an `Auth` object:

```{r}
a <- Auth$new(from = "env")
```

If you need to be logged into multiple accounts at the same time it is essential that you provide
environment variables for each of the accounts. Of course, these variables must have different names.

If you do not have pre-set environment variables, you can create them in the following way:

```{r}
# Set environment variables for the first account
sevenbridges2:::sbg_set_env(
  url = "https://api.sbgenomics.com/v2",
  token = "<your_token>",
  sysenv_url_name = "account_1_url",
  sysenv_token_name = "account_1_token"
)

# Set environment variables for the second account
sevenbridges2:::sbg_set_env(
  url = "https://api.sb.biodatacatalyst.nhlbi.nih.gov/v2/",
  token = "<your_token>",
  sysenv_url_name = "account_2_url",
  sysenv_token_name = "account_2_token"
)
```

Now you are ready to create authentication object for these two accounts:

```{r}
a <- sevenbridges2::Auth$new(
  from = "env",
  sysenv_url = "account_1_url",
  sysenv_token = "account_1_token"
)

b <- sevenbridges2::Auth$new(
  from = "env",
  sysenv_url = "account_2_url",
  sysenv_token = "account_2_token"
)
```

<a name="method3"/>***Method 3: User configuration file***

Assume we have already created the configuration file named
`credentials` under the directory `$HOME/.sevenbridges/`:

```
[aws-us-rfranklin]
api_endpoint = https://api.sbgenomics.com/v2
auth_token = token_for_this_user

# This is a comment:
# another user on the same platform
[aws-us-rosalind-franklin]
api_endpoint = https://api.sbgenomics.com/v2
auth_token = token_for_this_user

[default]
api_endpoint = https://cgc-api.sbgenomics.com/v2
auth_token = token_for_this_user

[gcp]
api_endpoint = https://gcp-api.sbgenomics.com/v2
auth_token = token_for_this_user
```

To load the user profile `aws-us-rfranklin` from this configuration file, simply use:

```{r}
a <- sevenbridges2::Auth$new(from = "file", profile_name = "aws-us-rfranklin")
```

If `profile_name` is not specified, we will try to load the profile named `[default]`:

```{r}
a <- sevenbridges2::Auth$new(from = "file")
```


The option based on the use of a configuration file also enables simultaneous authentication from multiple accounts. 
Assuming that we have a configuration file like the one listed above, and that we want to create authentication objects for two profiles (**default** and **aws-us-rfranklin**), we can achieve this in the following way:

```{r}
a <- sevenbridges2::Auth$new(from = "file", profile_name = "default")
b <- sevenbridges2::Auth$new(from = "file", profile_name = "aws-us-rfranklin")
```


***Note:*** API paths (base URLs) differ for each Seven Bridges environment. Be sure to provide the correct path for the environment you are using. API paths for some of the environments are:

+-------------------------------------------+---------------------------------------------------+---------------+
| Platform Name                             | API Base URL                                      | Short Name    |
+===========================================+===================================================+===============+
| Seven Bridges Platform (US)               | `https://api.sbgenomics.com/v2`                   | `"aws-us"`    |
+-------------------------------------------+---------------------------------------------------+---------------+
| Seven Bridges Platform (EU)               | `https://eu-api.sbgenomics.com/v2`                | `"aws-eu"`    |
+-------------------------------------------+---------------------------------------------------+---------------+
| Seven Bridges Platform (China)            | `https://api.sevenbridges.cn/v2`                  | `"ali-cn"`    |
+-------------------------------------------+---------------------------------------------------+---------------+
| Cancer Genomics Cloud (CGC)               | `https://cgc-api.sbgenomics.com/v2`               | `"cgc"`       |
+-------------------------------------------+---------------------------------------------------+---------------+
| Cavatica                                  | `https://cavatica-api.sbgenomics.com/v2`          | `"cavatica"`  |
+-------------------------------------------+---------------------------------------------------+---------------+
| BioData Catalyst Powered by Seven Bridges | `https://api.sb.biodatacatalyst.nhlbi.nih.gov/v2` | `"f4c"`       |
+-------------------------------------------+---------------------------------------------------+---------------+


</div>

<div align="right"><a href="#top">top</a></div>


## Get User Information

<a name="youruser"/>**Get your own information**

This call returns information about your account.

```{r}
a$user()
```

```
── User ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• country: United States
• affiliation: SBG
• last_name: Franklin
• first_name: Rosalind
• email: rosalind.franklin@sbgenomics.com
• username: RFranklin
• href: https://cgc-api.sbgenomics.com/v2/users/RFranklin
```

<div align="right"><a href="#top">top</a></div>


**Get information about a user**

This call returns information about the specified user. Note that currently you can view only your own user information, so this call is equivalent to the [call to get information about your account](#youruser).

```{r}
a$user(username = "RFranklin")
```

<div align="right"><a href="#top">top</a></div>


## Rate Limit

This call returns information about your current rate limit. This is the number of API calls you can make in five minutes. This call also returns information about your current instance limit.

```{r}
a$rate_limit()
```

```
── Rate Limit ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• rate
  • limit: 1000
  • remaining: 1000
  • reset: 2022-12-26 11:31:01 CET
• instance
  • limit: 25
  • remaining: 25
```

<div align="right"><a href="#top">top</a></div>

## Show Billing Information

Each project must have a Billing Group associated with it. This Billing Group pays for the storage and computation in the project.

For example, your first project(s) were created with the free funds from the Pilot Funds Billing Group assigned to each user at sign-up.

To get a list of paths used to access billing information via the API:

``` {r}
# get paths used to access billing information
a$billing()
```

To get information about your billing groups:

```{r}
# check your billing info
a$billing_groups()
a$invoice()
```

This call lists all your billing groups, including groups that are pending or have been disabled.

To get information about your invoices:
```{r}
a$invoice()
```

The call returns information about all your available invoices, unless you use the \code{billing_group_id} query parameter to specify the ID of a particular billing group, in which case it will return the invoice incurred by that billing group only.

To get a detailed information for a specific billing group, please use the billing_group method with the billing group ID. The information returned includes the billing group owner, the total balance, and the status of the billing group (pending, disabled,...). 

```{r}
a$billing_groups(id = "<billing_group_id>")
```

```
── Billing group info ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• disabled: FALSE
• pending: FALSE
• type: regular
• name: My billing group
• owner: <bg_owner's_username>
• id: <billing_group_id>
• href: https://api.sbgenomics.com/v2/billing/groups/<billing_group_id>
• balance
  • currency: USD
  • amount: 221
```

Keep in mind that you can assign the output of the previous call to a variable, which will be an R6 environment:
```{r}
my_billing_group <- a$billing_groups(id = "<billing_group_id>")
# you can still print the billing group info by calling the print method
my_billing_group$print()
```

You can also get detailed information for a specific billing group,.The following options are available to you:
\itemize{
  \item analysis breakdown
  \item storage breakdown
  \item egress breakdown
}

To get an analysis breakdown for a billing group which contains information on both the tasks and Cruncher analysis, call:

```{r}
my_billing_group$analysis_breakdown()
```

To get a storage breakdown for a billing group, call:

```{r}
my_billing_group$storage_breakdown()
```

Finally, you may want to get an egress breakdown for a billing group:

```{r}
my_billing_group$egress_breakdown()
```


To retrieve information about a selected invoice, including the costs for analysis and storage, and the invoice period, you can use the invoice method with the id parameter set to the ID of the invoice you are querying.

```{r}
a$invoice(id = "<invoice_id>")
```

```
── Invoice info ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• approval_date: 2022-02-01T00:00:00Z
• pending: FALSE
• invoice_id: <your_invoice_id>
• href: https://api.sbgenomics.com/v2/billing/invoices/<your_invoice_id>
• invoice_period
  • from: 2022-01-01T00:00:00Z
  • to: 2022-01-31T23:59:59Z
• analysis_costs
  • currency: USD
  • amount: 101.77
• storage_costs
  • currency: USD
  • amount: 256.11
• total
  • currency: USD
  • amount: 357.88
```
<div align="right"><a href="#top">top</a></div>


## Create Project

Projects are the core building blocks of the platform. Each project corresponds to a distinct scientific investigation, serving as a container for its data, analysis tools, results, and collaborators.

Create a new project called "api testing" with the billing group `id` obtained above.

```{r}
# list all available billing groups for currently logged in user
a$billing_groups()
# set billing group for the new project
bid <- "<billing_group_id>"
# create new project
(p <- a$project_new(
  name = "api testing", billing_group = bid,
  description = "Just a test"
))
```

```
── Project ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• category: PRIVATE
• root_folder: <root_folder_id>
• type: v2
• description: Just a test
• billing_group: <billing_group_id>
• name: new project
• id: <your_username>/new-project
• href: https://api.sbgenomics.com/v2/projects/<your_username>/new-project
• settings
  • locked: FALSE
  • controlled: FALSE
  • location: aws:us-east-1
  • use_interruptible_instances: TRUE
  • use_memoization: FALSE
  • intermediate_files: list(duration = 24, retention = "LIMITED")
  • allow_network_access: TRUE
  • use_elastic_disk: FALSE
```

<div align="right"><a href="#top">top</a></div>

The **new project** is created on the platform. Notice also that the variable p is an R6 object with fields that contain information about the platform project. The facility also has several methods that allow you to perform basic platform operations on the project.


## Get Details about Existing Project

```{r}
# list first 50 projects
a$projects()
# return all projects that contain the term "demo"
a$projects(query = list(name = "demo"))
# return all projects tagged with "test_1"
a$projects(query = list(tags = c("test_1")))
```

## Get Details of a Specified Project

```{r}
a$project_get(project_owner = "luna_lovegood", project = "nargles-project")
```

```
── Project ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• category: PRIVATE
• modified_on: 2022-12-20T16:09:20Z
• created_on: 2022-12-20T16:09:20Z
• created_by: luna_lovegood
• root_folder: 12a1ab12345a12345a12345a
• type: v2
• billing_group: ab12345a-123a-1234-1234-a1ab12a12ab1
• name: nargles-project
• id: luna_lovegood/nargles-project
• href: https://api.sbgenomics.com/v2/projects/luna_lovegood/nargles-project
• settings
  • locked: FALSE
  • controlled: FALSE
  • location: aws:us-east-1
  • use_interruptible_instances: TRUE
  • use_memoization: FALSE
  • intermediate_files: list(duration = 24, retention = "LIMITED")
  • allow_network_access: FALSE
  • use_elastic_disk: FALSE
• permissions
  • write: TRUE
  • read: TRUE
  • copy: TRUE
  • execute: TRUE
  • admin: TRUE
```

## Create a New Project

```{r}
a$project_new(
  name = "api_created_project",
  billing_group = "<your_billing_group_id>",
  description = "This project has been created using the
              sevenbridges2 R API library."
)
```

```
── Project ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
• category: PRIVATE
• root_folder: 12a123ab1234a12a1ab1234a
• type: v2
• description: This project has been created using the sevenbridges2 R 
API library.
• billing_group: <your_billing_group_id>
• name: api_created_project
• id: <owner>/api-created-project
• href: https://cgc-api.sbgenomics.com/v2/projects/<owner>/api-created-project
• settings
  • locked: FALSE
  • controlled: FALSE
  • location: aws:us-east-1
  • use_interruptible_instances: TRUE
  • use_memoization: FALSE
  • intermediate_files: list(duration = 24, retention = "LIMITED")
  • allow_network_access: FALSE
  • use_elastic_disk: FALSE
```

## Edit an existing project

If for some reason you want to edit an existing project, you can do so by using
the **edit** method on the Project class object. As a project Admin you can use
it to change the name, settings, tags or billing group of the project. For 
example, if you want to change the name and description of the project, you can
do it in the following way:

```{r}
p <- a$project_get(
  project_owner = "<your_username>",
  project = "<project's-short-name>"
)
p$edit(
  name = "project_with_modified_name",
  description = "This is the modified description."
)
```

Keep in mind that this modifies only the name of the project, not its short 
name. Therefore, after calling this method, the id of the project will remain 
the same \code{your_username/project's-short-name}.


## Delete a project

You may also want to delete some project from the Platform using through the R 
client library. To do that, you need to call the \code{delete} method on the 
project object:

```{r}
p <- a$project_get(
  project_owner = "<your_username>",
  project = "<project's-short-name>"
)
p$delete()
```

Please be careful when using this method and note that calling it will
permanently delete the project from the platform.


## List project members

To get a list of the members of the specified project:

```{r}
p$member_list()
```


## Add a member to a project

To add a new user to a specified project:

```{r}
p <- a$project_get(
  project_owner = "<your_username>",
  project = "<project's-short-name>"
)
p$member_add(username = "<username_of_a_user_you_want_to_add>")
```


Please keep in mind that this call can only be successfully made by a user who 
has admin permissions in the project.


## Remove a project member

On the other hand, you can delete a member from the project in a similar way:

```{r}
p$member_delete(username = "<username_of_a_user_you_want_to_remove>")
```


## Get a project member's permissions

Sometimes you may just want to investigate a members's permissions within a 
specified project, and you can do that by calling:

```{r}
p$member_permissions_get(username = "<username_of_a_user_of_interest>")
```


## Modify a project member's permissions

To modify a project member's permissions you can use the \code{
member_permissions_modify} method. For this method to work, the user calling it 
must have admin permissions in the project. For example, you may want to give 
admin permissions to a project member:

```{r}
p$member_permissions_modify(
  username = "<username_of_the_member_whose_permissions_you_are_editing>",
  admin = TRUE
)
```

## List project files

In order to list all files and folders (special type of files) within 
specified project object, you can use the Project's `files()` method. 

```{r}
p$files()
```

## Create folder within project's Files

You are also able to create a folder within project's root Files directory
using the method `create_folder()`. You would have to specify the folder name
which should not start with '__' or contain spaces. 

```{r}
p$create_folder(name = "My_new_folder")
```

## Get project's root folder object

Lastly, the project's root directory with all your files is a folder itself,
therefore you are able to get this folder as File object too using
`get_root_folder()`.

```{r}
p$get_root_folder()
```


## List files

List of `files` and `subdirectories` in a specified **project** or **directory** 
within a project, with specified properties that you can access. The project or 
directory whose contents you want to list is specified as a parameter in 
the call. Further properties to filter by can also be specified as query 
parameters.

Both `files` and `subdirectories` are of class `File`. The difference between
them is in the `type` parameter which is:

- `File` for `files`
- `Folder` for `subdirectories`

Note that this call lists both `files` and `subdirectories` in the 
specified project or directory within a project, 
but **not the contents of the subdirectories**. To list the contents of a 
subdirectory, make a new call and specify the subdirectory as the parent 
parameter.

```{r}
# List files in project root directory
a$files(project = "<project_object>")
```
```
[[1]]

── File ────────────────────────────────────────────────────────────────────────────────────────────────
• type: file
• parent: 61f3f9c6e6aad8667516bf30
• url: NA
• modified_on: 2023-04-15T08:54:32Z
• created_on: 2023-04-11T10:04:50Z
• project: vladimir_obucina/api-debug
• size: 56 bytes
• name: Drop-seq_small_example.bam
• id: 643530c286c9522d97313d17
• href: https://api.sbgenomics.com/v2/files/643530c286c9522d97313d17

[[2]]

── File ────────────────────────────────────────────────────────────────────────────────────────────────
• type: file
• parent: 61f3f9c6e6aad8667516bf30
• url: NA
• modified_on: 2023-04-11T10:29:13Z
• created_on: 2023-04-11T10:29:13Z
• project: vladimir_obucina/api-debug
• size: 56 bytes
• name: G20479.HCC1143.2_1Mreads.tar.gz
• id: 6435367997d9446ecb66cfb2
• href: https://api.sbgenomics.com/v2/files/6435367997d9446ecb66cfb2

```
``` {r}
# List files in subdirectory
a$files(parent = "<parent_directory_object>")
```

You can also try and find file with certain:

1. **Name** - List file with this name. (Note that the name must be an exact\
complete string for the results to match.)
2. **Metadata** - List only files that have the specified value in metadata\
field.
3. **Tag** - List files containing this tag. (Note that the tag must be an\
exact complete string for the results to match.)
4. **Origin task** - List only files produced by task specified by ID in\
this field.

```{r}
# List file with this name
a$files(project = "<project_object", name = "<file_name>")

# List file with metadata field value
a$files(
  project = "<project_object",
  metadata = list("<metadata_field>" = "<metadata_field_value>")
)

# List file with this tag
a$files(project = "<project_object", tag = c("<tag_value>"))

# List file from this task
a$files(project = "<project_object", task = "<task_object>")
```

Also there is an option to get certain file using it's ID
```{r}
a$get_file(file_id = "6435367997d9446ecb66cfb2")
```
```
── File ────────────────────────────────────────────────────────────────────────────────────────────────────────
• type: file
• parent: 61f3f9c6e6aad8667516bf30
• url: NA
• modified_on: 2023-04-11T10:29:13Z
• created_on: 2023-04-11T10:29:13Z
• project: vladimir_obucina/api-debug
• size: 56 bytes
• name: G20479.HCC1143.2_1Mreads.tar.gz
• id: 6435367997d9446ecb66cfb2
• href: https://api.sbgenomics.com/v2/files/6435367997d9446ecb66cfb2
```

## Copy files

This method allows you to copy files between projects. 
Unlike the call to copy a file between projects, 
this call lets you batch the copy operation and copy a list of files at a time.
```{r}
file1 <- a$get_file(file_id = "6435367997d9446ecb66cfb2")
file2 <- a$get_file(file_id = "6435367997d9446ecb66cgr2")

a$copy_files(files = list(file1, file2), destination_project = "<short-name-of-the-project>")
```

## Create a folder within the destination project or parent folder

To create a new folder on the Platform, use the authentication object's \code{
create_folder} method. It allows you to create a new folder on the Platform
within the root folder of a specified destination project or the provided
parent folder. Remember that you should provide either the destination project
(as the `project` parameter) or the
destination folder (as the `parent` parameter), not both.

The `project` parameter can be provided either as a Project object or as an ID
of a destination project. 

```{r}
# Option 1 - Using the project parameter

# Option 1.a (providing a Project object as project parameter)
my_project <- a$project_get(project = "<short-name-of-the-project>")
a$create_folder(name = "my_new_folder", project = my_project)

# Option 1.b (providing a project's ID as project parameter)
a$create_folder(name = "my_new_folder", project = "<project_id>")
```


Alternatively, you can provide the `parent` parameter to specify the
destination where the new folder is going to be created. The `parent`
parameter can be either a File object (must be of type `folder`) or
an ID of the parent destination folder.

```{r}
# Option 2 - Using the parent parameter

# Option 2.a (providing a File (must be a folder) object as parent parameter)
my_parent_folder <- a$get_file(id = "<folder_id>")
a$create_folder(name = "my_new_folder", parent = my_parent_folder)

# Option 2.b (providing a file's (folder's) ID as project parameter)
a$create_folder(name = "my_new_folder", parent = "<folder_id>")
```

## File print

File has a regular `print()` method which gives you most important information
about the file:
```{r}
# Regular file print
file$print()
```

```
── File ────────────────────────────────────────────────────────────────────────────────────────────────
• type: file
• parent: 61f3f9c6e6aad8667516bf30
• url: NA
• modified_on: 2023-04-15T08:54:32Z
• created_on: 2023-04-11T10:04:50Z
• project: vladimir_obucina/api-debug
• size: 56 bytes
• name: Drop-seq_small_example.bam
• id: 643530c286c9522d97313d17
• href: https://api.sbgenomics.com/v2/files/643530c286c9522d97313d17
```

But if you want to see all the details about the file in specific format,
you can use `detailed_print()` method:

```{r}
# Pretty print
file$detailed_print()
```
```
── File ────────────────────────────────────────────────────────────────────────────────────────────────────────
• type: file
• parent: 61f3f9c6e6aad8667516bf30
• url: NA
• modified_on: 2023-04-15T08:54:32Z
• created_on: 2023-04-11T10:04:50Z
• project: vladimir_obucina/api-debug
• size: 56 bytes
• name: Drop-seq_small_example.bam
• id: 643530c286c9522d97313d17
• href: https://api.sbgenomics.com/v2/files/643530c286c9522d97313d17
• tags
  • tag_1: TEST
  • tag_2: bla
• metadata
  • reference_genome: GSM1629193_hg19_ERCC
  • investigation: GSM1629193
  • md5_sum: 6294fee8200b29e03d3dc464f9c46a9c
  • sbg_public_files_category: test
• storage
  • type: PLATFORM
  • hosted_on_locations: list("aws:us-east-1", "aws:us-west-2")
```

## Update file details

User can also update the name, the full set metadata, and tags for a specified
file using `update_details()` method.

``` {r}
# Update file name
file$update_details(name = "<new_name>")

# Update file metadata
file$update_details(
  metadata = list("<metadata_field>" = "<metadata_field_value")
)

# Update file tags
file$update_details(tags = list("<tag_value>"))
```

## Add tags to a file

You can tag your files on the Platform with keywords to make it easier to 
identify and organize files you’ve imported from public datasets or copied 
between projects using `add_tag()` method. This method will automatically just 
add new tag to a list of already existing ones, but you also have an option to 
set `overwrite` parameter, which will erase old ones and set the new one.

```{r}
# Add new tag to a file
file$add_tag(tags = list("new_tag"))

# Add new tag to a file and overwrite old ones
file$add_tag(tags = list("new_tag"), overwrite = TRUE)
```

## Copy a file between projects

This call copies the specified file to a new project. Files retain their 
metadata when copied, but may be assigned new names in their target project.
If you don't specify new name the file will retain it's old name in new project.
To make this call, you should have 
[copy permission](https://docs.sevenbridges.com/docs/set-permissions) 
within the project you are copying from. This call returns `File` object of 
newly copied file.

```{r}
# Copy file to a new project and set a new name
file$copy_to(project = "<destination_project_object>", name = "<new_name>")
```

## Get downloadable URL for a file

To get URL that you can use to download the specified file, you can use
`get_download_url()` method. This will set `url` parameter of a file and can 
later be used to download file.

```{r}
# Get downloadable URL for a file
file$get_download_url()
```


## Get a file's metadata
`File` object has `get_metadata()` method which returns the metadata values for 
the specified file. This will pull and reload file's metadata from the platform.

```{r}
# Get file metadata
file$get_metadata()
```

## Modify a file's metadata

User is also able to modify a file's metadata using `set_metadata()` method.
Here you can also use `overwrite` parameter if you want to erase previous
metadata fields and add new one (by default it's set to `FALSE`).

```{r}
# Set file metadata
file$set_metadata(
  metadata_fields = list("<metadata_field>" = "metadata_field_value"),
  overwrite = TRUE
)
```

## List folder contents

Directory can have multiple `files`/`subdirectories` inside. You can see them
using `list_contents()` method.

```{r}
# List folder contents
folder$list_contents()
```

## Delete a file/folder

User can delete files and folders using `delete()` method. The only thing you
need to be aware of is that `folder` can only be deleted if it's empty.

```{r}
# Delete a file
file$delete()

# Delete a folder
folder$delete()
```


## Download a file

`File` object has a `download()` method, which allows you to download that file
to your local computer. You should provide the `directory_path` parameter, 
which specifies the destination directory to which your file will be 
downloaded. By default, this parameter is set to your current working
directory. You can also set the new name for your resulting (downloaded)
file by providing the `filename` parameter. Otherwise, the default name 
(the one stored in the `name` field of your `File` object) will be used.

```{r}
# Download a file
file$download(directory_path = "/path/to/your/destination/folder")
```

## Upload single file

You can upload files from your local computer to the Platform using the 
`upload()` method on your `Auth` object. The method allows you to upload only
a single file. 

To upload a file you should provide its full path on your local computer
as the `path` parameter.

To specify upload destination for your file you can use either `project` or
`parent` parameter. These two parameters should not be used together.

* **project** - `Project` object or project ID.
* **parent** - `File` object (of type `Folder`) or its ID.

#### Upload a single file

```{r}
a <- Auth$new(platform = "aws-us", token = "<your-token>")


# Option 1 - Using the project parameter
# Option 1.a (providing a Project object as project parameter)
destination_project <- a$project_get(project = "<short-name-of-the-project>")

up <- a$upload(
  path = "/path/to/your/file.txt",
  project = destination_project,
  overwrite = TRUE
)
# Call start() method do start upload process
up$start()

# Option 1.b (providing a project's ID as project parameter)
up <- a$upload(
  path = "/path/to/your/file.txt",
  project = "<project_id>",
  overwrite = TRUE
)
# Call start() method do start upload process
up$start()


# Option 2 - Using the parent parameter
# Option 2.a (providing a File (must be a folder) object as parent parameter)
destination_folder <- a$get_file(id = "<folder_id>")

up <- a$upload(
  path = "/path/to/your/file.txt",
  parent = destination_folder,
  overwrite = TRUE
)
# Call start() method do start upload process
up$start()

# Option 2.b (providing a file's (folder's) ID as project parameter)
up <- a$upload(
  path = "/path/to/your/file.txt",
  parent = "<destination_folder_id>",
  overwrite = TRUE
)
# Call start() method do start upload process
up$start()
```

If you want to skip the step where you need to call the `start()` method
to start the actual upload process, you can use the `init` parameter
when calling the `upload()` method. If `init` parameter is set to `FALSE`
the upload process will start right away.

```{r}
a <- Auth$new(platform = "aws-us", token = "<your-token>")

destination_project <- a$project_get(project = "<short-name-of-the-project>")

up <- a$upload(
  path = "/path/to/your/file.txt",
  project = destination_project,
  overwrite = TRUE,
  init = FALSE
)
```

#### List all ongoing uploads

The method `list_ongoing_uploads()` allows you to see the list of all
ongoing upload processes.

```{r}
# List ongoing uploads
a$list_ongoing_uploads()
```

#### Abort upload process

You can abort any uploading process using the `upload_abort()` method.
To do so, you need to provide the ID of a process within the `upload_id`
parameter.

```{r}
# Abort upload
a$abort_upload(upload_id = "<id_of_the_upload_process>")
```


## List apps

You can list all apps available to by calling the `apps$query()` method from
the authentication object. The method has several parameters that allow you to
search for apps in various places and by specified search terms. 

Note that you can see all of the publicly available apps on the Seven Bridges
Platform by setting the the `visibility` parameter to `public`. If you omit this
parameter (it will use the default value `private`), and you will see all your
private apps, i.e. those in projects that you can access. Learn more about
public apps in our documentation.

```{r}
# Query public apps - set visibility parameter to "public"
a$apps$query(visibility = "public", limit = 10)
```

The same can be done for private apps. The following call will return all the
apps available to you, i.e. all the apps that you have in your projects:

```{r}
# Query private apps - set limit to 10
a$apps$query(limit = 10)
```

Keep in mind that not all of the available apps are going to be returned,
because the `limit` parameter is set to 10. 

Alternatively, you can query all the apps in a specific project by providing
the project of interest using the `project` parameter. You can either use the
Project object, or a project ID (string).

```{r}
# Query apps within your project - set limit to 10
a$apps$query(project = "<project_object_or_its_ID>", limit = 10)
```


You can also use one or more search terms via the `query_terms` parameter to
query all apps that are available to you. Search terms should relate to the
following app details:

* name
* label
* toolkit
* toolkit version
* category
* tagline
* description

For example, to get public apps that contain term **"VCFtools"** anywhere in
the mentioned app's details, you can make a call similar to this:

```{r}
# List public apps containing the term "VCFtools" in app's details
a$apps$query(visibility = "public", query_terms = list("VCFtools"), limit = 10)
```

For the query to return results, each term must match at least one of the
fields that describe an app. For example, the first term can match the app's
name while the second can match the app description. However, if any part of
the search fails to match app details, the call will return an empty list.


Another useful option is to query apps by id. You can do so either for public
apps, or for private apps (apps available to you). The following example 
illustrates how this can be done for public apps:

```{r}
# List files in project root directory
a$apps$query(visibility = "public", id = "admin/sbg-public-data/vcftools-convert")
```

### List project apps

All available apps in a specific project can also be listed by calling the
`list_apps()` method directly on the Project object. This method has redefined
the `project` and `visibility` arguments, while all other parameters are
identical to those presented for `apps$query()`.

```{r}
# List all apps in specified project
p$list_apps(limit = 10)
```

## Get app information

If you need information about a specific app, you can get it using the
`apps$get()` method. Keep in mind that the app should be one in a project that
you can access. This could be an app that has been uploaded to the Seven
Bridges Platform by a project member, or a publicly available app. You should
provide an `id` of the app of interest, and optionally its `revision`. If no
revision is specified, the latest one will be used.

```{r}
# Get a public App object and assign it to an object
bcftools_app <- a$apps$get(id = "admin/sbg-public-data/bcftools-call-1-15-1")
```



## Copy an app


To copy an app to a specified destination project, you can use the 
`apps$copy()` method. 

Keep in mind that the app should be one in a project that
you can access. This could be an app that has been uploaded to the Seven
Bridges Platform by a project member, or a publicly available app.

Destination project (`project` parameter) should be provided either as an
object of `Project` class, or as an ID of the targer project of interest.

You might want to set the new name that the app will have in the target
project. To so so, use the `name` parameter. If app's name will not change,
omit the `name` parameter.

Keep in mind that are different strategies for copying the apps on the
platform:

* `clone` : copy all revisions; get updates from the same app as the copied app (default)
* `direct`: copy latest revision; get updates from the copied app
* `clone_direct`: copy all revisions; get updates from the copied app
* `transient`: copy latest revision; get updates from the same app as the copied app

Learn more about copy strategies in our PUBLIC API documentation.


The following example demonstrates how can you copy the previosuly created
`bcftools_app` to some project:

```{r}
# Copy app to a project
app_copy <- a$apps$copy(bcftools_app,
  project = "<project_object_or_its_ID>",
  name = "new_app_name"
)
```


## Create new app

This `apps$create()` method allows you to add an app using the raw CWL.

The raw CWL can be provided either through the `raw` parameter, or by using the
`file_path` parameter. Keep in mind that these two parameters should not be
used together.

If you choose to use the `raw` parameter, make sure to provide a list
containing a raw CWL for the app revision you are about to create. To generate
such a list, you might want to load some existing `JSON` / `YAML` file. In case
that your CWL file is in JSON format, please use the `fromJSON` function from
the `jsonlite` package to minimize potential problems with parsing the JSON
file. If you want to load a CWL file in YAML format, it is highly recommended
to use the `read_yaml` function from the `yaml` package. 

Make sure to set the `raw_format` parameter to match the type of the provide
raw CWL file (`JSON` / `YAML`). By default, this parameter is set to `JSON`.

```{r}
# Load the JSON file
file_json <- jsonlite::read_json("/path/to/your/raw_cwl_in_json_format.cwl")

# Create app from raw CWL (JSON)
new_app_json <- a$apps$create(
  project = "<destination_project_object_or_its_ID>",
  raw = file_json,
  name = "new_app_json",
  raw_format = "JSON"
)
```


If you opt for `file_path` parameter instead, you should provide a path to a
file containing the raw CWL for the app (`JSON` or `YAML`).

```{r}
# Create app from raw CWL (YAML)
new_app_yaml <- a$apps$create(
  project = dest_proj,
  from_path = "/path/to/your/raw_cwl_in_yaml_format.cwl",
  name = "new_app_yaml",
  raw_format = "YAML"
)
```

### Create app in project

The app can also be directly created on a Project object by invoking
`create_app()`. Except it has the predefined `project` parameter, the
`create_app()` has the same other parameters as `apps$create()`.

```{r}
# Create app from raw CWL (JSON) in specified project
p$create_app(  
  raw = file_json,
  name = "new_app_json",
  raw_format = "JSON")
```
## App object

Once you have an App object, you'll see that it also has various useful methods
within itself.

The following actions are available for an App object:
* print
* get_revision
* create_revision
* copy
* sync


## Print app

The `print` method prints the content of the App object to the console.

```{r}
# Print app's details
new_app_json$print()
```
```

── App ──────────────────────────────────────────────────────────────────────────────────────────────────────
• latest_revision: 0
• copy_of: admin/sbg-public-data/bcftools-call-1-15-1/0
• revision: 0
• name: BCFtools Call
• project: user_123/test-project
• id: user_123/test-project/new_app_json
• href: https://api.sbgenomics.com/v2/apps/user_123/test-project/new_app_json/0
```

## Get app's revision

To obtain a particular revision of an app, use the `get_revision()` method. If
you need a specific revision of an app, use the `revision` parameter. 

Keep in mind that there is another important parameter that can be set for this
method. If the `in_place` parameter is set to `TRUE`, the current app object
will be replaced with new for specified app revision. By default, this
parameter is set to false.

```{r}
my_app <- a$apps$get(id = "user_123/test-project/my_app/0")
my_app$print()
```
```

── App ──────────────────────────────────────────────────────────────────────────────────────────────────────
• latest_revision: 1
• revision: 0
• name: BCFtools Call
• project: user_123/test-project
• id: user_123/test-project/my_app
• href: https://api.sbgenomics.com/v2/apps/user_123/test-project/my_app/0
```


```{r}
# Get app's revision
my_app$get_revision(revision = 1)
```

```{r}
# Get app's revision and update the object
my_app$get_revision(revision = 1, in_place = TRUE)
```


## Create app's revision

The `create_revision()` method allows you to create a new revision for an
existing app.

The raw CWL can be provided either through the `raw` parameter, or by using the
`file_path` parameter. Keep in mind that these two parameters should not be
used together.

If you choose to use the `raw` parameter, make sure to provide a list
containing a raw CWL for the app revision you are about to create. To generate
such a list, you might want to load some existing `JSON` / `YAML` file. In case
that your CWL file is in JSON format, please use the `fromJSON` function from
the `jsonlite` package to minimize potential problems with parsing the JSON
file. If you want to load a CWL file in YAML format, it is highly recommended
to use the `read_yaml` function from the `yaml` package. 

Make sure to set the `raw_format` parameter to match the type of the provide
raw CWL file (`JSON` / `YAML`). By default, this parameter is set to `JSON`.

```{r}
raw_cwl_as_list <- jsonlite::read_json("/path/to/your/raw_cwl_in_json_format.cwl")
my_app$create_revision(raw = raw_cwl_as_list, in_place = TRUE)
```

If you opt for `file_path` parameter instead, you should provide a path to a
file containing the raw CWL for the app (`JSON` or `YAML`).

```{r}
# Create new revision for the existing app
my_app$create_revision(from_path = "/path/to/your/raw_cwl_in_json_format.cwl", in_place = TRUE)
```


## Copy an app

An app can be copied to a specified destination project directly from an
app's object, by calling its `copy()`method.

Destination project (`project` parameter) should be provided either as an
object of `Project` class, or as an ID of the targer project of interest.

You might want to set the new name that the app will have in the target
project. To so so, use the `name` parameter. If app's name will not change,
omit the `name` parameter.

Keep in mind that are different strategies for copying the apps on the
platform:

* `clone` : copy all revisions; get updates from the same app as the copied app (default)
* `direct`: copy latest revision; get updates from the copied app
* `clone_direct`: copy all revisions; get updates from the copied app
* `transient`: copy latest revision; get updates from the same app as the copied app

Learn more about copy strategies in our PUBLIC API documentation.

```{r}
copied_app <- my_app$copy(
  project = "<destination_project_object_or_its_ID>",
  name = "new_app_name"
)
```


## Sync a copied app

To synchronize a copied app with the source app from which it has been copied,
you can use the `sync()` method.

```{r}
# Sync copied app to the latest revision created
copied_app$sync()
```
